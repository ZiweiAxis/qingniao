# Session Bridge - å¯¹è¯æ— ç¼åˆ‡æ¢

å®ç° Claude Code â†” é£ä¹¦/é’‰é’‰/å¾®ä¿¡ çš„æ— ç¼å¯¹è¯åˆ‡æ¢ã€‚

## ğŸ¯ åŠŸèƒ½

- âœ… è‡ªåŠ¨æ£€æµ‹åˆ‡æ¢æ„å›¾ï¼ˆ"åˆ‡åˆ°é£ä¹¦"ã€"ç¦»å¼€ä¸€ä¸‹"ç­‰ï¼‰
- âœ… ä¿å­˜å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆæœ€è¿‘ 20 æ¡æ¶ˆæ¯ï¼‰
- âœ… åˆ‡æ¢åˆ°ç§»åŠ¨ç«¯ç»§ç»­å¯¹è¯
- âœ… éšæ—¶åˆ‡å›ç»ˆç«¯
- âœ… ä¼šè¯çŠ¶æ€æŒä¹…åŒ–

## ğŸš€ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šä¸´æ—¶ç¦»å¼€

```
ä½ : æˆ‘ç¦»å¼€ä¸€ä¸‹ï¼Œåˆ‡åˆ°é£ä¹¦
AI: ğŸ”„ å¯¹è¯å·²åˆ‡æ¢åˆ°é£ä¹¦
    ä¼šè¯ID: session_1234567890
    ä¸Šä¸‹æ–‡: 5 æ¡æ¶ˆæ¯
    
    æœ€è¿‘å¯¹è¯ï¼š
    1. ä½ : å¸®æˆ‘å†™ä¸ªå‡½æ•°
    2. AI: å¥½çš„ï¼Œæˆ‘æ¥å†™...
    ...
    
    å›å¤ã€Œåˆ‡å›æ¥ã€å¯ä»¥åˆ‡å›ç»ˆç«¯

â³ ç»ˆç«¯è¿›å…¥ç­‰å¾…æ¨¡å¼...
   ï¼ˆåœ¨æ‰‹æœºä¸Šç»§ç»­å¯¹è¯ï¼Œè¯´ã€Œåˆ‡å›æ¥ã€å¯ä»¥åˆ‡å›ï¼‰
```

**åœ¨é£ä¹¦ä¸Šï¼š**
```
ä½ : ç»§ç»­å†™é‚£ä¸ªå‡½æ•°
AI: å¥½çš„ï¼Œæˆ‘ç»§ç»­...ï¼ˆä¸Šä¸‹æ–‡å·²åŒæ­¥ï¼‰
```

**åˆ‡å›ç»ˆç«¯ï¼š**
```
ä½ : åˆ‡å›æ¥
AI: âœ… å¯¹è¯å·²åˆ‡å›ç»ˆç«¯
    ä¼šè¯ID: session_1234567890

ä½ : ç»§ç»­
AI: å¥½çš„ï¼Œæˆ‘ä»¬åˆšæ‰è¯´åˆ°...ï¼ˆä¸Šä¸‹æ–‡å®Œæ•´ï¼‰
```

### åœºæ™¯ 2ï¼šå¤šå¹³å°åä½œ

```
ä½ : åˆ‡åˆ°é’‰é’‰ï¼Œæˆ‘è¦åœ¨ä¼šè®®ä¸Šå±•ç¤º
AI: ğŸ”„ å¯¹è¯å·²åˆ‡æ¢åˆ°é’‰é’‰

ï¼ˆåœ¨é’‰é’‰ä¸Šç»§ç»­å¯¹è¯ï¼‰

ä½ : åˆ‡å›æ¥
AI: âœ… å¯¹è¯å·²åˆ‡å›ç»ˆç«¯
```

## ğŸ“‹ API

### getSessionBridge()

è·å–ä¼šè¯æ¡¥æ¥å™¨å®ä¾‹ã€‚

```javascript
const { getSessionBridge } = require("@skills/message-bridge/session-bridge");

const bridge = await getSessionBridge();
```

### bridge.handleMessage(userMessage)

å¤„ç†ç”¨æˆ·æ¶ˆæ¯ï¼Œè‡ªåŠ¨æ£€æµ‹åˆ‡æ¢æ„å›¾ã€‚

```javascript
const result = await bridge.handleMessage("åˆ‡åˆ°é£ä¹¦");

if (result.switched) {
  console.log(`åˆ‡æ¢åˆ°: ${result.platform}`);
  console.log(result.message);
}
```

**è¿”å›å€¼ï¼š**
```javascript
{
  switched: true,           // æ˜¯å¦å‘ç”Ÿåˆ‡æ¢
  platform: "feishu",       // ç›®æ ‡å¹³å°
  message: "å¯¹è¯å·²åˆ‡æ¢..."  // æç¤ºæ¶ˆæ¯
}
```

### bridge.handleAIResponse(response)

è®°å½• AI å›å¤åˆ°ä¸Šä¸‹æ–‡ã€‚

```javascript
await bridge.handleAIResponse("å¥½çš„ï¼Œæˆ‘æ¥å¸®ä½ ...");
```

### bridge.getStatus()

è·å–å½“å‰ä¼šè¯çŠ¶æ€ã€‚

```javascript
const status = bridge.getStatus();

console.log(status);
// {
//   sessionId: "session_1234567890",
//   platform: "terminal",
//   platformName: "ç»ˆç«¯",
//   contextLength: 10,
//   startTime: "2026-02-10T09:00:00.000Z",
//   lastActivity: "2026-02-10T09:05:00.000Z",
//   isWaitingForSwitch: false
// }
```

## ğŸ”§ é›†æˆåˆ° Claude Code

### 1. åœ¨ System Prompt ä¸­æ·»åŠ 

```
ä½ æ˜¯ Claude Code åŠ©æ‰‹ã€‚å½“ç”¨æˆ·è¯´ã€Œåˆ‡åˆ°é£ä¹¦ã€ã€ã€Œç¦»å¼€ä¸€ä¸‹ã€ç­‰è¯æ±‡æ—¶ï¼š

1. è°ƒç”¨ SessionBridge å¤„ç†åˆ‡æ¢
2. ä¿å­˜å½“å‰å¯¹è¯ä¸Šä¸‹æ–‡
3. é€šçŸ¥ç”¨æˆ·åˆ‡æ¢æˆåŠŸ
4. ç»ˆç«¯è¿›å…¥ç­‰å¾…æ¨¡å¼

å½“ç”¨æˆ·åœ¨ç§»åŠ¨ç«¯è¯´ã€Œåˆ‡å›æ¥ã€æ—¶ï¼š
1. æ¢å¤å¯¹è¯ä¸Šä¸‹æ–‡
2. ç»§ç»­ä¹‹å‰çš„å¯¹è¯
```

### 2. åœ¨ä»£ç ä¸­é›†æˆ

```javascript
const { getSessionBridge } = require("@skills/message-bridge/session-bridge");

async function handleUserMessage(userMessage) {
  const bridge = await getSessionBridge();
  
  // å¤„ç†æ¶ˆæ¯
  const result = await bridge.handleMessage(userMessage);
  
  if (result.switched) {
    // å‘ç”Ÿåˆ‡æ¢
    if (result.platform === "terminal") {
      // åˆ‡å›ç»ˆç«¯
      return "å¯¹è¯å·²åˆ‡å›ï¼Œæˆ‘ä»¬ç»§ç»­å§";
    } else {
      // åˆ‡åˆ°ç§»åŠ¨ç«¯
      return `å¯¹è¯å·²åˆ‡æ¢åˆ°${result.platform}ï¼Œè¯·åœ¨æ‰‹æœºä¸Šç»§ç»­`;
    }
  }
  
  // æ­£å¸¸å¤„ç†
  const aiResponse = await generateAIResponse(userMessage);
  await bridge.handleAIResponse(aiResponse);
  
  return aiResponse;
}
```

## ğŸ¨ åˆ‡æ¢å…³é”®è¯

### åˆ‡åˆ°ç§»åŠ¨ç«¯
- "åˆ‡åˆ°é£ä¹¦"
- "é£ä¹¦"
- "æ‰‹æœº"
- "ç¦»å¼€ä¸€ä¸‹"
- "åˆ‡åˆ°é’‰é’‰"
- "é’‰é’‰"
- "åˆ‡åˆ°å¾®ä¿¡"
- "å¾®ä¿¡"

### åˆ‡å›ç»ˆç«¯
- "åˆ‡å›æ¥"
- "å›æ¥"
- "ç»§ç»­"

## ğŸ“Š ä¼šè¯çŠ¶æ€å­˜å‚¨

ä¼šè¯çŠ¶æ€ä¿å­˜åœ¨ï¼š
```
.sessions/
  â””â”€â”€ active.json  # å½“å‰æ´»è·ƒä¼šè¯
```

**active.json æ ¼å¼ï¼š**
```json
{
  "sessionId": "session_1234567890",
  "platform": "terminal",
  "context": [
    {
      "role": "user",
      "content": "å¸®æˆ‘å†™ä¸ªå‡½æ•°",
      "timestamp": "2026-02-10T09:00:00.000Z"
    },
    {
      "role": "assistant",
      "content": "å¥½çš„ï¼Œæˆ‘æ¥å†™...",
      "timestamp": "2026-02-10T09:00:05.000Z"
    }
  ],
  "startTime": "2026-02-10T09:00:00.000Z",
  "lastActivity": "2026-02-10T09:05:00.000Z"
}
```

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œ Claude Code é›†æˆç¤ºä¾‹
node example-claude-code.js
```

**æµ‹è¯•æµç¨‹ï¼š**
1. è¾“å…¥æ­£å¸¸å¯¹è¯
2. è¾“å…¥"åˆ‡åˆ°é£ä¹¦"
3. ç»ˆç«¯è¿›å…¥ç­‰å¾…æ¨¡å¼
4. åœ¨é£ä¹¦ä¸Šç»§ç»­å¯¹è¯
5. è¯´"åˆ‡å›æ¥"
6. ç»ˆç«¯æ¢å¤å¯¹è¯

## ğŸ”® æœªæ¥æ‰©å±•

- [ ] æ”¯æŒå¤šä¼šè¯å¹¶è¡Œ
- [ ] æ”¯æŒä¼šè¯å†å²æŸ¥çœ‹
- [ ] æ”¯æŒä¼šè¯åˆ†äº«
- [ ] æ”¯æŒä¼šè¯å¯¼å‡º
- [ ] æ”¯æŒè¯­éŸ³åˆ‡æ¢
- [ ] æ”¯æŒè‡ªåŠ¨åˆ‡æ¢ï¼ˆæ ¹æ®è®¾å¤‡çŠ¶æ€ï¼‰

## ğŸ’¡ å®ç°åŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Claude Code    â”‚
â”‚   (ç»ˆç«¯)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session Bridge  â”‚  â† ä¼šè¯ç®¡ç†å™¨
â”‚  - ä¸Šä¸‹æ–‡å­˜å‚¨   â”‚
â”‚  - åˆ‡æ¢æ£€æµ‹     â”‚
â”‚  - çŠ¶æ€åŒæ­¥     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MessageBridge   â”‚  â† æ¶ˆæ¯æ¡¥æ¢
â”‚  - å‘é€æ¶ˆæ¯     â”‚
â”‚  - æ¥æ”¶å›å¤     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é£ä¹¦/é’‰é’‰/å¾®ä¿¡ â”‚
â”‚    (æ‰‹æœº)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ å…³é”®ç‰¹æ€§

1. **ä¸Šä¸‹æ–‡ä¿æŒ** - åˆ‡æ¢æ—¶ä¿ç•™æœ€è¿‘ 20 æ¡æ¶ˆæ¯
2. **æ— ç¼åˆ‡æ¢** - ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œå¯¹è¯è¿ç»­
3. **åŒå‘åˆ‡æ¢** - ç»ˆç«¯ â†” ç§»åŠ¨ç«¯ éšæ—¶åˆ‡æ¢
4. **çŠ¶æ€æŒä¹…åŒ–** - é‡å¯åæ¢å¤ä¼šè¯
5. **å¤šå¹³å°æ”¯æŒ** - é£ä¹¦/é’‰é’‰/å¾®ä¿¡

---

**è®©å¯¹è¯éšæ—¶éšåœ°ï¼Œæ— ç¼è¡”æ¥ï¼** ğŸš€
